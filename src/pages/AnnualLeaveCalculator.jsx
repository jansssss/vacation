import React, { useMemo, useState } from "react";
import CalculatorTemplate from "../components/CalculatorTemplate";
import { calculateAnnualLeave } from "../lib/calculators/annualLeave";
import { formatNumber, formatDate } from "../lib/formatters";
import { RULES_2026 } from "../config/rules/2026";

const AnnualLeaveCalculator = () => {
  const [startDate, setStartDate] = useState("");
  const [endDate, setEndDate] = useState("");
  const [attendanceRate, setAttendanceRate] = useState(80);

  const result = useMemo(() => {
    if (!startDate || !endDate) return null;
    return calculateAnnualLeave(startDate, endDate);
  }, [startDate, endDate]);

  const remainderMonths = result ? result.months % 12 : 0;

  const summaryLines = result && !result.error
    ? [
        `??獄쏆뮇源??怨쀪컧: ${formatNumber(result.total)}??,
        `域뱀눘?썸묾怨뚯퍢: ${result.years}??${remainderMonths}揶쏆뮇??(疫꿸퀣???${formatDate(endDate)})`,
        result.months < 12
          ? `1??沃섎챶彛??닌덉퍢 ?遺욧컧 ${formatNumber(result.breakdown[0]?.days || 0)}??獄쏆뮇源?
          : "",
        result.months >= 12
          ? `1????곴맒 ?닌덉퍢?? 疫꿸퀡??${RULES_2026.annualLeave.baseAfterOneYear}??+ 揶쎛???怨쀪컧 ?怨몄뒠`
          : "",
        attendanceRate < 80 ? "?곗뮄???80% 沃섎챶彛?揶쎛?? ??쇱젫 獄쏆뮇源??怨쀪컧揶쎛 餓κ쑴堉??????됰뮸??덈뼄." : "",
      ].filter(Boolean)
    : [
        "??녾텢??⑤궢 疫꿸퀣???깆뱽 ??낆젾??롢늺 ??됯맒 ?怨쀪컧 獄쏆뮇源???깅땾???類ㅼ뵥??????됰뮸??덈뼄.",
        "?곗뮄???80% 沃섎챶彛? ??곸춦 ?源? 癰귢쑬猷?野꺜?醫? ?袁⑹뒄??몃빍??",
        "?④쑴沅?野껉퀗?????뿅?筌〓㈇???뱀뵠筌?筌ㅼ뮇伊??癒?뼊?? ??? 域뱀뮇????怨뺤キ??덈뼄.",
      ];

  const steps = result && !result.error
    ? [
        `??녾텢??${formatDate(startDate)}?봔??疫꿸퀣???${formatDate(endDate)}繹먮슣? ${result.years}??${remainderMonths}揶쏆뮇??野껋럡??,
        `1??沃섎챶彛??닌덉퍢 ?遺욧컧 ??룻?${formatNumber(result.breakdown[0]?.days || 0)}??,
        result.months >= 12
          ? `1????곴맒 ?닌덉퍢 疫꿸퀡??${RULES_2026.annualLeave.baseAfterOneYear}??+ 2?袁⑥춳??${RULES_2026.annualLeave.extraPerTwoYears}??揶쎛??筌ㅼ뮆? ${RULES_2026.annualLeave.maxTotal}??`
          : "",
        `??獄쏆뮇源??怨쀪컧 ${formatNumber(result.total)}??,
      ].filter(Boolean)
    : [
        "??녾텢??⑤궢 疫꿸퀣???깆뱽 ??낆젾",
        "域뱀눘?썸묾怨뚯퍢??????μ맄嚥??④쑴沅?,
        "1??沃섎챶彛??遺욧컧 + 1????곴맒 ?怨쀪컧????밴텦",
        "?곗뮄?????곸춦 ????됱뇚??癰귢쑬猷??癒?",
      ];

  const exceptions = [
    "?곗뮄???μ뵠 80% 沃섎챶彛?????遺욧컧 獄쏆뮇源????쀫립??????됰뮸??덈뼄.",
    "?얜떯???곸춦夷??곷씜 疫꿸퀗而?? 域뱀눘???怨쀬젟???怨밸샨????됱뱽 ????됰뮸??덈뼄.",
    "雅?4???袁⑥젾域뱀눖以??????젟域뱀눖以??癰궰野????怨쀪컧 ??깅땾?? ?袁㏉닊 ??뤾텦?????わ쭪臾먮빍??",
    "疫꿸퀗而????λ뻻揶?域뱀눖以?癒?뮉 域뱀눖以덃④쑴鍮?疫꿸퀗而숁???쇱젫 域뱀눖以??깆뱽 ??ｍ뜞 ?類ㅼ뵥??곷튊 ??몃빍??",
    "?怨쀪컧 ?λ맩彛??뺣즲 ??곸겫 ??????怨뺤뵬 ??곸뜞夷???늾 筌ｌ꼶??獄쎻뫗??????わ쭪臾먮빍??",
  ];

  const cases = [
    "??? 1) 2025-03-01 ??녾텢, 2026-02-28 ??곴텢 ??됱젟: 1??沃섎챶彛??닌덉퍢 ?遺욧컧 11??獄쏆뮇源? 2026-03-01 ??꾩뜎 2?袁⑷컧 疫꿸퀡??15??깆뵠 獄쏆뮇源?",
    "??? 2) ?얜떯???곸춦 2揶쏆뮇????釉? ?遺욧컧 2??깆뵠 ??뽰뇚??????됰선 疫꿸퀣?????????袁⑹뒄.",
    "??? 3) 雅?4??域뱀눖龜: ?怨쀪컧 ??깅땾????덉뵬??롪돌, ?怨쀪컧??롫뼣 ??뤾텦 ?????맒?袁㏉닊 疫꿸퀣?????쇰뻻 ?類ㅼ뵥.",
  ];

  const faqs = [
    {
      question: "?怨쀪컧 獄쏆뮇源?疫꿸퀣???? ??녾텢??깆뵥揶쎛??",
      answer: "???맒 ??녾텢??깆뱽 疫꿸퀣???곗쨮 ??롪돌, ???텢 域뱀뮇????怨뺤뵬 ????怨뺣즲 疫꿸퀣????怨몄뒠??????됰뮸??덈뼄.",
    },
    {
      question: "1??沃섎챶彛?疫꿸퀗而?癒?뮉 筌???깆뵠 獄쏆뮇源??롪돌??",
      answer: "筌띲끉??1??깅뎃 獄쏆뮇源??롫┷, ?곗뮄????遺쎄탷 ?겸뫗?????????ｍ뜞 ?類ㅼ뵥??곷튊 ??몃빍??",
    },
    {
      question: "?곗뮄???80% 疫꿸퀣??? ??堉멨칰??④쑴沅??롪돌??",
      answer: "???젟域뱀눖以????????쇱젫 ?곗뮄?????쑴???疫꿸퀣???곗쨮 ?怨쀬젟??몃빍??",
    },
    {
      question: "?얜떯???곸춦 疫꿸퀗而??域뱀눘?????釉??롪돌??",
      answer: "??곸춦 ?ル굝履?? ???텢 域뱀뮇????怨뺤뵬 ???わ쭪?????됰선 癰귢쑬猷??類ㅼ뵥???袁⑹뒄??몃빍??",
    },
    {
      question: "?怨쀪컧??롫뼣?? ??堉??袁㏉닊 疫꿸퀣???곗쨮 ?④쑴沅??롪돌??",
      answer: "???맒?袁㏉닊 ?癒?뮉 ???뇧?袁㏉닊 ?怨몄뒠 ??????類ㅼ뵥??곷튊 ??렽????텢 域뱀뮇????怨밸샨??餓λ씭???",
    },
    {
      question: "?怨쀪컧 ?λ맩彛??뺣즲????곸겫??롢늺 ???늾??롪돌??",
      answer: "??덇땀 ??됯컧???怨룹씩??띿쓺 筌욊쑵六??野껋럩?????늾 筌ｌ꼶???????됰뮸??덈뼄.",
    },
    {
      question: "??곴텢 ??沃섎챷沅???怨쀪컧????堉멨칰??類ㅺ텦??롪돌??",
      answer: "沃섎챷沅???怨쀪컧????????롫뼣 筌왖疫뀀맩??獄쏆뮇源??????됱몵筌??怨쀬젟 疫꿸퀣???깆뱽 ?類ㅼ뵥??곷튊 ??몃빍??",
    },
    {
      question: "雅?4??域뱀눖龜?癒?벥 ?怨쀪컧 ??깅땾??餓κ쑴堉??뺢돌??",
      answer: "?怨쀪컧 ??깅땾????덉뵬??롪돌, ?袁㏉닊 ??뤾텦 疫꿸퀣??????わ쭪?????됰뮸??덈뼄.",
    },
    {
      question: "?怨쀪컧 獄쏆뮇源??怨밸립?? ??덇돌??",
      answer: `???맒 筌ㅼ뮆? ${RULES_2026.annualLeave.maxTotal}????뺣즲揶쎛 ?怨몄뒠??몃빍??`,
    },
    {
      question: "?④쑴沅?野껉퀗??? ??쇱젫 ?봔???怨쀪컧揶쎛 ??? ????덇돌??",
      answer: "???텢???봔??疫꿸퀣??? ??곸춦 筌ｌ꼶?? ?λ맩彛??뺣즲 ????뿅??遺우뵥??獄쏆꼷???????됰뮸??덈뼄.",
    },
  ];

  const sources = [
    "域뱀눖以덃묾怨?甕곕벡湲??怨쀪컧 ?醫됲닋??? 域뱀뮇???遺용튋 ?怨몄뒠)",
    `疫꿸퀣??? ${RULES_2026.effectiveDate} / ??낅쑓??꾨뱜: ${RULES_2026.updatedAt}`,
    "?곗뮄????遺쎄탷 獄???곸춦 筌ｌ꼶??疫꿸퀣??? ??毓??域뱀뮇?숁???깆젟??곴퐤 ?類ㅼ뵥 ?袁⑹뒄",
  ];

  const relatedLinks = [
    { title: "??곸춦疫??④쑴沅쎿묾?, path: "/calculators/severance-pay" },
    { title: "?怨쀪컧 疫꿸퀡??域뱀뮇???????遺용튋", path: "/guides/annual-leave-basics" },
    { title: "?怨쀪컧 ??곸뜞 疫꿸퀣??????늾 ??뽰젎", path: "/guides/annual-leave-carryover" },
    { title: "?怨쀪컧??롫뼣 ?類ㅺ텦 ???酉釉???살첒", path: "/guides/annual-leave-encashment" },
    { title: "?얜떯???곸춦???怨쀪컧/??곸춦疫뀀뜆肉?沃섎챷????怨밸샨", path: "/guides/unpaid-leave-impact" },
    { title: "??곸춦疫?筌왖疫??????癒?뼊 疫꿸퀣?", path: "/guides/severance-pay-eligibility" },
    { title: "???뇧?袁㏉닊 ?怨쀬젟 ????釉???뽰뇚 ????, path: "/guides/severance-pay-average-wage" },
    { title: "疫뀀맩肉э쭗?녾쉭????덈뮉 甕?, path: "/guides/payroll-slip-reading" },
    { title: "?④쑴沅쎿묾???덊닏嚥???猷?, path: "/calculators" },
  ];

  const trust = {
    checklist: [
      "??녾텢??疫꿸퀣???疫꿸퀣? ?怨쀪컧 獄쏆뮇源????뵠???類ㅼ뵥",
      "?곗뮄????怨쀬젟 域뱀눊援?? 域뱀눛源??癒?┷ ?類ｋ궖",
      "??곸춦/??곷씜 疫꿸퀗而?筌ｌ꼶??疫꿸퀣? ?얜챷苑??,
      "?怨쀪컧 ?λ맩彛??뺣즲 ??쀫뻬 ????? ??덇땀 疫꿸퀡以?,
      "?怨쀪컧??롫뼣 筌왖疫?疫꿸퀣?(???맒?袁㏉닊/???뇧?袁㏉닊) ?癒?",
      "??곴텢???怨쀪컧 ?類ㅺ텦 ??깆젟??筌왖疫?獄쎻뫗???類ㅼ뵥",
    ],
    disputePoints: [
      "疫꿸퀣???깆뱽 ????怨뺣즲嚥??怨몄뒠????筌욊낯????덇땀 沃섎챸??,
      "?얜떯???곸춦 疫꿸퀗而???釉????????????곴퐤 筌△뫁??,
      "?怨쀪컧 ?λ맩彛??뺣즲 ??됯컧 ?袁⑥뵭??곗쨮 ?紐낅립 ???늾 ?브쑴??,
    ],
    notices: [
      "?怨쀪컧 獄쏆뮇源??獄????쒏묾怨좊립?? ??녾텢??疫꿸퀣???곗쨮 ?怨몄뒠??렽? 揶쏆뮇?ㅸ퉪??遺용연??깅땾????苑?癒?퐣 ?類ㅼ뵥 獄쏅뗀???덈뼄.",
      "?怨쀪컧 沃섎챷沅?????λ맩彛???덇땀??獄쏆뮇???륁궎??筌롫뗄???類ㅼ뵥 ????깆젟 ???????④쑵????源낆쨯??雅뚯눘苑??",
      "?얜떯???곸춦/??곷씜 疫꿸퀗而?? ?怨쀪컧 獄쏆뮇源???怨밸샨??餓?????됱몵???紐꾧텢?????????얜챷??獄쏅뗀???덈뼄.",
    ],
  };

  const breadcrumbs = [
    { label: "??, path: "/" },
    { label: "?④쑴沅쎿묾?, path: "/calculators" },
    { label: "?怨쀪컧 ?④쑴沅쎿묾?, path: "/calculators/annual-leave" },
  ];

  return (
    <CalculatorTemplate
      seo={{
        title: "?怨쀪컧 ?④쑴沅쎿묾?,
        description: "??녾텢??⑤궢 疫꿸퀣???깆뱽 ??낆젾??롢늺 ?怨쀪컧 獄쏆뮇源???깅땾????ｍ롨퉪袁⑥쨮 ?④쑴沅??몃빍??",
        path: "/calculators/annual-leave",
      }}
      breadcrumbs={breadcrumbs}
      title="?怨쀪컧 ?④쑴沅쎿묾?
      description="??녾텢??⑤궢 疫꿸퀣???疫꿸퀣???곗쨮 獄쏆뮇源?揶쎛?館釉??怨쀪컧 ??깅땾???④쑴沅??랁? ??뿅???됱뇚?? FAQ繹먮슣? ??ｍ뜞 ??볥궗??몃빍??"
      updatedAt={RULES_2026.updatedAt}
      summaryLines={summaryLines}
      steps={steps}
      exceptions={exceptions}
      cases={cases}
      faqs={faqs}
      sources={sources}
      relatedLinks={relatedLinks}
      trust={trust}
    >
      <div className="space-y-6">
        <div className="grid gap-4 md:grid-cols-2">
          <label className="text-sm text-slate-600">
            ??녾텢??            <input
              type="date"
              value={startDate}
              onChange={(event) => setStartDate(event.target.value)}
              className="mt-2 w-full rounded-lg border border-slate-200 px-3 py-2"
            />
          </label>
          <label className="text-sm text-slate-600">
            疫꿸퀣?????곸춦 ??됱젟??
            <input
              type="date"
              value={endDate}
              onChange={(event) => setEndDate(event.target.value)}
              className="mt-2 w-full rounded-lg border border-slate-200 px-3 py-2"
            />
          </label>
        </div>

        <label className="text-sm text-slate-600">
          ?곗뮄???揶쎛??%)
          <input
            type="number"
            value={attendanceRate}
            onChange={(event) => setAttendanceRate(Number(event.target.value))}
            className="mt-2 w-full rounded-lg border border-slate-200 px-3 py-2"
            min={0}
            max={100}
          />
          <p className="mt-2 text-xs text-slate-400">
            ?곗뮄???{attendanceRate}% 疫꿸퀣?. 80% 沃섎챶彛?????遺욧컧 獄쏆뮇源????쀫립??????됰뮸??덈뼄.
          </p>
        </label>

        {result && result.error && (
          <div className="rounded-xl border border-rose-100 bg-rose-50 p-4 text-sm text-rose-600">
            {result.error}
          </div>
        )}

        {result && !result.error && (
          <div className="rounded-xl border border-emerald-100 bg-emerald-50 p-4">
            <div className="flex items-baseline justify-between">
              <p className="text-sm text-emerald-700">??獄쏆뮇源??怨쀪컧</p>
              <p className="text-2xl font-semibold text-emerald-800">
                {formatNumber(result.total)}??              </p>
            </div>
            <div className="mt-4 space-y-2 text-sm text-slate-600">
              {result.breakdown.map((item) => (
                <div key={item.label} className="flex justify-between">
                  <span>{item.label}</span>
                  <span>{formatNumber(item.days)}??/span>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </CalculatorTemplate>
  );
};

export default AnnualLeaveCalculator;
