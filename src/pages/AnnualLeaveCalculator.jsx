import React, { useMemo, useState } from "react";
import CalculatorTemplate from "../components/CalculatorTemplate";
import { calculateAnnualLeave } from "../lib/calculators/annualLeave";
import { formatNumber, formatDate } from "../lib/formatters";
import { RULES_2026 } from "../config/rules/2026";

const AnnualLeaveCalculator = () => {
  const [startDate, setStartDate] = useState("");
  const [endDate, setEndDate] = useState("");
  const [attendanceRate, setAttendanceRate] = useState(80);

  const result = useMemo(() => {
    if (!startDate || !endDate) return null;
    return calculateAnnualLeave(startDate, endDate);
  }, [startDate, endDate]);

  const remainderMonths = result ? result.months % 12 : 0;

  const summaryLines = result && !result.error
    ? [
        `???꾩룇裕뉑틦???⑥れ빵: ${formatNumber(result.total)}??,
        `?잙????몃Ь?⑤슣?? ${result.years}??${remainderMonths}?띠룇裕??(?リ옇????${formatDate(endDate)})`,
        result.months < 12
          ? `1??亦껋꼶梨뜹퐲???뚮뜆????븐슙而?${formatNumber(result.breakdown[0]?.days || 0)}???꾩룇裕뉑틦?
          : "",
        result.months >= 12
          ? `1????怨대쭜 ??뚮뜆??? ?リ옇???${RULES_2026.annualLeave.baseAfterOneYear}??+ ?띠럾?????⑥れ빵 ??⑤챷??
          : "",
        attendanceRate < 80 ? "?怨쀫츇???80% 亦껋꼶梨뜹퐲??띠럾??? ???깆젷 ?꾩룇裕뉑틦???⑥れ빵?띠럾? 繞벿븐뫒????????곕????덈펲." : "",
      ].filter(Boolean)
    : [
        "???얩뀬???ㅺ땁 ?リ옇????源녿굵 ???놁졑??濡?듆 ????쭜 ??⑥れ빵 ?꾩룇裕뉑틦???源낅빢???筌먦끉逾???????곕????덈펲.",
        "?怨쀫츇???80% 亦껋꼶梨뜹퐲? ??怨몄땋 ?繹? ?곌랙?х뙴??롪틵???? ?熬곣뫗???紐껊퉵??",
        "??ｌ뫒亦??롪퍒??????肉?嶺뚣볝늾???諭逾좂춯?嶺뚣끉裕뉏펺????堉?? ???? ?잙?裕?????⑤벡????덈펲.",
      ];

  const steps = result && !result.error
    ? [
        `???얩뀬??${formatDate(startDate)}?遊붋???リ옇????${formatDate(endDate)}濚밸Ŧ?? ${result.years}??${remainderMonths}?띠룇裕???롪퍔???,
        `1??亦껋꼶梨뜹퐲???뚮뜆????븐슙而???猷뼘?${formatNumber(result.breakdown[0]?.days || 0)}??,
        result.months >= 12
          ? `1????怨대쭜 ??뚮뜆???リ옇???${RULES_2026.annualLeave.baseAfterOneYear}??+ 2?熬곣뫁異??${RULES_2026.annualLeave.extraPerTwoYears}???띠럾???嶺뚣끉裕? ${RULES_2026.annualLeave.maxTotal}??`
          : "",
        `???꾩룇裕뉑틦???⑥れ빵 ${formatNumber(result.total)}??,
      ].filter(Boolean)
    : [
        "???얩뀬???ㅺ땁 ?リ옇????源녿굵 ???놁졑",
        "?잙????몃Ь?⑤슣???????關留꾢슖???ｌ뫒亦?,
        "1??亦껋꼶梨뜹퐲???븐슙而?+ 1????怨대쭜 ??⑥れ빵????諛댄뀰",
        "?怨쀫츇?????怨몄땋 ?????깅뇶???곌랙?х뙴????",
      ];

  const exceptions = [
    "?怨쀫츇???關逾?80% 亦껋꼶梨뜹퐲???????븐슙而??꾩룇裕뉑틦?????ル┰???????곕????덈펲.",
    "??쒕뼬???怨몄땋鸚??怨룹뵜 ?リ옇?쀨?? ?잙??????⑥ъ젧????⑤갭??????깅굵 ?????곕????덈펲.",
    "??4???熬곣뫁?얍윜諭?뽨빳???????잌윜諭?뽨빳???곌떠???????⑥れ빵 ??源낅빢?? ?熬곥룊????琉얩뀰??????륁??얜Ŧ鍮??",
    "?リ옇?쀨????貫六삥뤆??잙??뽨빳???裕??잙??뽨빳?꺜?ｌ뫒???リ옇?쀨뚯늸?????깆젷 ?잙??뽨빳??源녿굵 ??節띾쐾 ?筌먦끉逾??怨룻뒍 ??紐껊퉵??",
    "??⑥れ빵 ?貫留⒴퐲??類ｌ┣ ??怨멸껀 ???????⑤벡逾???怨몃쐾鸚?????嶺뚳퐣瑗???꾩렮維???????륁??얜Ŧ鍮??",
  ];

  const cases = [
    "??? 1) 2025-03-01 ???얩뀬, 2026-02-28 ??怨댄뀬 ???깆젧: 1??亦껋꼶梨뜹퐲???뚮뜆????븐슙而?11???꾩룇裕뉑틦? 2026-03-01 ??袁⑸쐩 2?熬곣뫕而??リ옇???15??源녿턄 ?꾩룇裕뉑틦?",
    "??? 2) ??쒕뼬???怨몄땋 2?띠룇裕?????? ??븐슙而?2??源녿턄 ??戮곕뇶???????곗꽑 ?リ옇??????????熬곣뫗??",
    "??? 3) ??4???잙??뽳쨭: ??⑥れ빵 ??源낅빢?????됰뎄??濡る룎, ??⑥れ빵??濡ル샬 ??琉얩뀰 ?????留?熬곥룊???リ옇???????곕뻣 ?筌먦끉逾?",
  ];

  const faqs = [
    {
      question: "??⑥れ빵 ?꾩룇裕뉑틦??リ옇????? ???얩뀬??源녿데?띠럾???",
      answer: "???留????얩뀬??源녿굵 ?リ옇????怨쀬Ŧ ??濡る룎, ??????잙?裕?????⑤벡逾???????⑤베利??リ옇??????⑤챷????????곕????덈펲.",
    },
    {
      question: "1??亦껋꼶梨뜹퐲??リ옇?쀨???裕?嶺???源녿턄 ?꾩룇裕뉑틦??濡る룎??",
      answer: "嶺뚮씞???1??源낅럠 ?꾩룇裕뉑틦??濡モ뵹, ?怨쀫츇?????븐럡???寃몃쳴?????????節띾쐾 ?筌먦끉逾??怨룻뒍 ??紐껊퉵??",
    },
    {
      question: "?怨쀫츇???80% ?リ옇???? ????됰ŀ移???ｌ뫒亦??濡る룎??",
      answer: "????잌윜諭?뽨빳?????????깆젷 ?怨쀫츇??????????リ옇????怨쀬Ŧ ??⑥ъ젧??紐껊퉵??",
    },
    {
      question: "??쒕뼬???怨몄땋 ?リ옇?쀨???잙??????????濡る룎??",
      answer: "??怨몄땋 ??リ턁筌?? ??????잙?裕?????⑤벡逾?????륁???????곗꽑 ?곌랙?х뙴??筌먦끉逾???熬곣뫗???紐껊퉵??",
    },
    {
      question: "??⑥れ빵??濡ル샬?? ??????熬곥룊???リ옇????怨쀬Ŧ ??ｌ뫒亦??濡る룎??",
      answer: "???留?熬곥룊?????裕??????熬곥룊????⑤챷????????筌먦끉逾??怨룻뒍 ??????????잙?裕?????⑤갭???繞벿살뵯???",
    },
    {
      question: "??⑥れ빵 ?貫留⒴퐲??類ｌ┣????怨멸껀??濡?듆 ??????濡る룎??",
      answer: "???뉖? ????빵????⑤９????우벟 嶺뚯쉳?듸쭛???롪퍔????????嶺뚳퐣瑗????????곕????덈펲.",
    },
    {
      question: "??怨댄뀬 ??亦껋꼶梨룡쾮????⑥れ빵??????됰ŀ移??筌먦끆???濡る룎??",
      answer: "亦껋꼶梨룡쾮????⑥れ빵????????濡ル샬 嶺뚯솘??ル留???꾩룇裕뉑틦???????깅さ嶺???⑥ъ젧 ?リ옇????源녿굵 ?筌먦끉逾??怨룻뒍 ??紐껊퉵??",
    },
    {
      question: "??4???잙??뽳쨭???踰???⑥れ빵 ??源낅빢??繞벿븐뫒???類?룎??",
      answer: "??⑥れ빵 ??源낅빢?????됰뎄??濡る룎, ?熬곥룊????琉얩뀰 ?リ옇????????륁???????곕????덈펲.",
    },
    {
      question: "??⑥れ빵 ?꾩룇裕뉑틦???⑤갭由?? ???뉖룎??",
      answer: `???留?嶺뚣끉裕? ${RULES_2026.annualLeave.maxTotal}????類ｌ┣?띠럾? ??⑤챷???紐껊퉵??`,
    },
    {
      question: "??ｌ뫒亦??롪퍒???? ???깆젷 ?遊붋????⑥れ빵?띠럾? ??? ?????뉖룎??",
      answer: "???????遊붋???リ옇???? ??怨몄땋 嶺뚳퐣瑗?? ?貫留⒴퐲??類ｌ┣ ????肉???븐슦逾???꾩룇瑗????????곕????덈펲.",
    },
  ];

  const sources = [
    "?잙??뽨빳?껊Ь???뺢퀡踰→묾???⑥れ빵 ??ル맪???? ?잙?裕????븐슜????⑤챷??",
    `?リ옇???? ${RULES_2026.effectiveDate} / ???낆몥??袁⑤콦: ${RULES_2026.updatedAt}`,
    "?怨쀫츇?????븐럡??????怨몄땋 嶺뚳퐣瑗???リ옇???? ??驪???잙?裕??겶???源놁젧??怨댄맍 ?筌먦끉逾??熬곣뫗??,
  ];

  const relatedLinks = [
    { title: "??怨몄땋????ｌ뫒亦낆렲臾?, path: "/calculators/severance-pay" },
    { title: "??⑥れ빵 ?リ옇????잙?裕????????븐슜??, path: "/guides/annual-leave-basics" },
    { title: "??⑥れ빵 ??怨몃쐾 ?リ옇???????????戮곗젍", path: "/guides/annual-leave-carryover" },
    { title: "??⑥れ빵??濡ル샬 ?筌먦끆??????됀?????댁쾼", path: "/guides/annual-leave-encashment" },
    { title: "??쒕뼬???怨몄땋????⑥れ빵/??怨몄땋?ル?녻굢?亦껋꼶梨?????⑤갭??, path: "/guides/unpaid-leave-impact" },
    { title: "??怨몄땋??嶺뚯솘??????????堉??リ옇??", path: "/guides/severance-pay-eligibility" },
    { title: "?????熬곥룊????⑥ъ젧 ????????戮곕뇶 ????, path: "/guides/severance-pay-average-wage" },
    { title: "?ル留⑵굢?彛??얠돪?????덈츎 ??, path: "/guides/payroll-slip-reading" },
    { title: "??ｌ뫒亦낆렲臾????딅땹???????, path: "/calculators" },
  ];

  const trust = {
    checklist: [
      "???얩뀬???リ옇?????リ옇?? ??⑥れ빵 ?꾩룇裕뉑틦????逾???筌먦끉逾?,
      "?怨쀫츇?????⑥ъ젧 ?잙??딀뤃?? ?잙??쎿틦???????筌먲퐢沅?,
      "??怨몄땋/??怨룹뵜 ?リ옇?쀨?嶺뚳퐣瑗???リ옇?? ??쒖굣???,
      "??⑥れ빵 ?貫留⒴퐲??類ｌ┣ ???ル뺄 ????? ???뉖? ?リ옇?▽빳?,
      "??⑥れ빵??濡ル샬 嶺뚯솘????リ옇??(???留?熬곥룊???????熬곥룊?? ???",
      "??怨댄뀬????⑥れ빵 ?筌먦끆????源놁젧??嶺뚯솘????꾩렮維???筌먦끉逾?,
    ],
    disputePoints: [
      "?リ옇????源녿굵 ??????⑤베利꿨슖???⑤챷?????嶺뚯쉳??????뉖? 亦껋꼶梨??,
      "??쒕뼬???怨몄땋 ?リ옇?쀨????????????????怨댄맍 嶺뚢뼰維??,
      "??⑥れ빵 ?貫留⒴퐲??類ｌ┣ ????빵 ?熬곣뫁逾??怨쀬Ŧ ?筌뤿굝由???????釉뚯뫒??,
    ],
    notices: [
      "??⑥れ빵 ?꾩룇裕뉑틦????????뤿Ь?⑥쥓由?? ???얩뀬???リ옇????怨쀬Ŧ ??⑤챷????? ?띠룇裕??명돦???븐슜???源낅빢???????????筌먦끉逾??꾩룆?????덈펲.",
      "??⑥れ빵 亦껋꼶梨룡쾮?????貫留⒴퐲????뉖????꾩룇裕???瑜곴텕??嶺뚮∥????筌먦끉逾?????源놁젧 ????????ｌ뫓????繹먮굞夷???낅슣?섋땻??",
      "??쒕뼬???怨몄땋/??怨룹뵜 ?リ옇?쀨?? ??⑥れ빵 ?꾩룇裕뉑틦????⑤갭???繞??????깅さ???筌뤾쑨???????????쒖굣???꾩룆?????덈펲.",
    ],
  };

  const breadcrumbs = [
    { label: "??, path: "/" },
    { label: "??ｌ뫒亦낆렲臾?, path: "/calculators" },
    { label: "??⑥れ빵 ??ｌ뫒亦낆렲臾?, path: "/calculators/annual-leave" },
  ];

  return (
    <CalculatorTemplate
      seo={{
        title: "??⑥れ빵 ??ｌ뫒亦낆렲臾?,
        description: "???얩뀬???ㅺ땁 ?リ옇????源녿굵 ???놁졑??濡?듆 ??⑥れ빵 ?꾩룇裕뉑틦???源낅빢????節띉濡⑦돦熬곣뫁夷???ｌ뫒亦??紐껊퉵??",
        path: "/calculators/annual-leave",
      }}
      breadcrumbs={breadcrumbs}
      title="??⑥れ빵 ??ｌ뫒亦낆렲臾?
      description="???얩뀬???ㅺ땁 ?リ옇?????リ옇????怨쀬Ŧ ?꾩룇裕뉑틦??띠럾??繞③뇡???⑥れ빵 ??源낅빢????ｌ뫒亦???겶? ??肉????깅뇶?? FAQ濚밸Ŧ?? ??節띾쐾 ??蹂κ텢??紐껊퉵??"
      updatedAt={RULES_2026.updatedAt}
      summaryLines={summaryLines}
      steps={steps}
      exceptions={exceptions}
      cases={cases}
      faqs={faqs}
      sources={sources}
      relatedLinks={relatedLinks}
      trust={trust}
    >
      <div className="space-y-6">
        <div className="grid gap-4 md:grid-cols-2">
          <label className="text-sm text-slate-600">
            ???얩뀬??            <input
              type="date"
              value={startDate}
              onChange={(event) => setStartDate(event.target.value)}
              className="mt-2 w-full rounded-lg border border-slate-200 px-3 py-2"
            />
          </label>
          <label className="text-sm text-slate-600">
            ?リ옇??????怨몄땋 ???깆젧??
            <input
              type="date"
              value={endDate}
              onChange={(event) => setEndDate(event.target.value)}
              className="mt-2 w-full rounded-lg border border-slate-200 px-3 py-2"
            />
          </label>
        </div>

        <label className="text-sm text-slate-600">
          ?怨쀫츇????띠럾???%)
          <input
            type="number"
            value={attendanceRate}
            onChange={(event) => setAttendanceRate(Number(event.target.value))}
            className="mt-2 w-full rounded-lg border border-slate-200 px-3 py-2"
            min={0}
            max={100}
          />
          <p className="mt-2 text-xs text-slate-400">
            ?怨쀫츇???{attendanceRate}% ?リ옇??. 80% 亦껋꼶梨뜹퐲???????븐슙而??꾩룇裕뉑틦?????ル┰???????곕????덈펲.
          </p>
        </label>

        {result && result.error && (
          <div className="rounded-xl border border-rose-100 bg-rose-50 p-4 text-sm text-rose-600">
            {result.error}
          </div>
        )}

        {result && !result.error && (
          <div className="rounded-xl border border-emerald-100 bg-emerald-50 p-4">
            <div className="flex items-baseline justify-between">
              <p className="text-sm text-emerald-700">???꾩룇裕뉑틦???⑥れ빵</p>
              <p className="text-2xl font-semibold text-emerald-800">
                {formatNumber(result.total)}??              </p>
            </div>
            <div className="mt-4 space-y-2 text-sm text-slate-600">
              {result.breakdown.map((item) => (
                <div key={item.label} className="flex justify-between">
                  <span>{item.label}</span>
                  <span>{formatNumber(item.days)}??/span>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </CalculatorTemplate>
  );
};

export default AnnualLeaveCalculator;
